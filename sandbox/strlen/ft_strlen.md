# ft_strlen.asm - アセンブリ版 strlen 関数の詳細解説

## 概要
このファイルは C 言語の `strlen` 関数をx86-64アセンブリ言語で実装したものです。
文字列の長さ（ヌル文字を除く文字数）を計算して返します。

## C言語での同等コード
```c
size_t ft_strlen(const char *str) {
    size_t len = 0;
    while (str[len] != '\0') {
        len++;
    }
    return len;
}
```

## アセンブリ基礎知識

### レジスタについて
- **rdi**: 第1引数を格納（文字列のポインタ）
- **rax**: 戻り値を格納（文字列の長さ）
- **rbp**: ベースポインタ（スタックフレーム管理）
- **rsp**: スタックポインタ
- **ecx/cl**: 一時的なデータ格納用

### セクションについて
- `.text`: 実行可能なコードを配置するセクション

## コードの詳細解説

### 1. 関数の宣言とエクスポート
```asm
section .text
    global _ft_strlen
```
- `section .text`: 実行可能コードのセクションを開始
- `global _ft_strlen`: この関数を外部から呼び出し可能にする

### 2. 関数プロローグ（開始処理）
```asm
_ft_strlen:
    push rbp        ; 現在のベースポインタをスタックに保存
    mov rbp, rsp    ; 新しいスタックフレームを設定
```
**役割**: 関数呼び出し時のスタック状態を保存し、新しいスタックフレームを作成

### 3. カウンタの初期化
```asm
    xor rax, rax    ; rax = 0 (文字列長カウンタを0で初期化)
```
**役割**: 戻り値となる文字列長カウンタを0で初期化
**なぜxor？**: `mov rax, 0` より高速で、同じ結果が得られる

### 4. メインループ
```asm
.loop_start:
    movzx ecx, byte [rdi]   ; rdiが指すバイト(1文字)をecxに読み込み、0拡張
```
**詳細**: 
- `byte [rdi]`: rdiが指すメモリアドレスから1バイト読み込み
- `movzx`: ゼロ拡張移動（上位ビットを0で埋める）
- 結果として、文字列の現在の文字がecxレジスタに格納される

### 5. 終了条件のチェック
```asm
    cmp cl, 0       ; 読み込んだ文字がヌル文字(0)かチェック
    je .end_func    ; ヌル文字なら関数終了へジャンプ
```
**詳細**:
- `cl`: ecxレジスタの下位8ビット（1文字分）
- `cmp`: 比較命令（フラグを設定するだけ）
- `je`: 等しい場合（Zero Flag が1）にジャンプ

### 6. ポインタとカウンタの更新
```asm
    inc rdi         ; 文字列ポインタを次の文字に進める
    inc rax         ; 文字列長カウンタをインクリメント
    jmp .loop_start ; ループの開始に戻る
```
**詳細**:
- `inc`: インクリメント命令（+1）
- `jmp`: 無条件ジャンプ

### 7. 関数エピローグ（終了処理）
```asm
.end_func:
    pop rbp         ; 保存していたベースポインタを復元
    ret             ; 関数から戻る（raxの値が戻り値）
```
**詳細**:
- `pop rbp`: スタックから以前のrbpの値を復元
- `ret`: 関数から戻る（戻り値はraxレジスタの値）

## 実行フロー例

文字列 "ABC" の場合：

1. **初期状態**: rdi → "ABC\0", rax = 0
2. **1回目**: 'A' を読み込み → ≠ 0 → rdi++, rax = 1
3. **2回目**: 'B' を読み込み → ≠ 0 → rdi++, rax = 2  
4. **3回目**: 'C' を読み込み → ≠ 0 → rdi++, rax = 3
5. **4回目**: '\0' を読み込み → = 0 → 終了, return 3

## 呼び出し規約（x86-64 System V ABI）
- **第1引数**: rdi レジスタ
- **戻り値**: rax レジスタ
- **保存が必要なレジスタ**: rbp（この関数で使用）

## パフォーマンス特性
- **時間計算量**: O(n) - nは文字列の長さ
- **空間計算量**: O(1) - 定数メモリのみ使用
- **最適化**: レジスタのみ使用でメモリアクセスを最小化 